(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-evaluate"],{"16ea":function(t,e,a){"use strict";a.r(e);var i=a("65c2"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},"28e9":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[t._l(t.orderProductList,function(e,i){return a("v-uni-view",{staticClass:"evaluation-item"},[a("v-uni-view",{staticClass:"evaluation-product"},[a("v-uni-image",{attrs:{src:e.productImageUrl,mode:"aspectFill"}}),a("v-uni-text",{staticClass:"desc"},[t._v(t._s(e.productName)+"}")])],1),a("v-uni-view",{staticClass:"evaluation-star"},[a("v-uni-view",{staticClass:"desc"},[a("v-uni-text",[t._v("商品描述相符")])],1),a("v-uni-view",{staticClass:"star"},t._l(e.stars,function(e,o){return a("v-uni-image",{staticClass:"star-item",attrs:{src:e?"../../static/temp/redstar.png":"../../static/temp/star.png"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeProductRank(i,o)}}})}),1)],1),a("v-uni-view",{staticClass:"evaluation-comment"},[a("v-uni-textarea",{attrs:{placeholder:"商品满足你的期望吗？说说它的优点和美中不足的地方吧"},model:{value:e.comment,callback:function(a){t.$set(e,"comment",a)},expression:"orderProduct.comment"}})],1),a("v-uni-view",{staticClass:"evaluation-image"},[a("robby-image-upload",{attrs:{fileKeyName:"files",header:t.header,formData:t.formData,"server-url":t.uploadUrl},model:{value:e.imageUrlList,callback:function(a){t.$set(e,"imageUrlList",a)},expression:"orderProduct.imageUrlList"}})],1)],1)}),a("v-uni-button",{staticClass:"evaluate-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.evaluate.apply(void 0,arguments)}}},[t._v("发表")])],2)},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})},4676:function(t,e,a){"use strict";a.r(e);var i=a("28e9"),o=a("16ea");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("b4d7");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,"3652480a",null);e["default"]=r.exports},"54f0":function(t,e,a){"use strict";a.r(e);var i=a("8d57"),o=a("9a3c");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("afde");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,"03a99f1b",null);e["default"]=r.exports},"5df3":function(t,e,a){"use strict";var i=a("02f4")(!0);a("01f9")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,a=this._i;return a>=e.length?{value:void 0,done:!0}:(t=i(e,a),this._i+=t.length,{value:t,done:!1})})},"65c2":function(t,e,a){"use strict";var i=a("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("ac6a");var o=i(a("cebc")),s=i(a("54f0")),n=a("2f62"),r={components:{robbyImageUpload:s.default},data:function(){return{orderNo:"",order:{},orderProductList:[],uploadUrl:this.$api.request.apiBaseUrl+"uploadSingleFile",formData:{},header:{}}},onLoad:function(t){this.orderNo=t.orderNo,this.inquiryOrder(this.orderNo)},computed:(0,o.default)({},(0,n.mapState)(["hasLogin","userInfo"])),methods:{inquiryOrder:function(t){var e=this;this.$api.request.orderDetail({orderNo:t},function(t){"0"===t.body.status.statusCode?(e.order=t.body.data,e.orderProductList=e.order.orderProductDTOList,e.initProductEvaluation(e.orderProductList)):console.log(t.body.status.errorDesc)})},initProductEvaluation:function(t){var e=this,a=[];t.forEach(function(t,i){e.$set(t,"stars",[1,1,1,1,1]),e.$set(t,"commentRank",5),e.$set(t,"imageUrlList",[]),a.push(t)}),this.orderProductList=a},changeProductRank:function(t,e){for(var a=[0,0,0,0,0],i=0;i<=4;i++)i<=e?a.splice(i,1,1):a.splice(i,1,0);this.$set(this.orderProductList[t],"stars",a),this.$set(this.orderProductList[t],"commentRank",e+1)},evaluate:function(){var t=this,e=this,a=[];this.orderProductList.forEach(function(t,i){var o={commentContent:t.comment,commentRank:t.commentRank,orderUuid:e.order.orderUuid,productUuid:t.productDTO.productUuid,imageUrlList:t.imageUrlList};a.push(o)}),this.$api.request.commentOrder({actionType:"ADD",commentList:a},function(e){"0"===e.body.status.statusCode?(t.$api.msg("订单评价成功"),setTimeout(function(){uni.navigateTo({url:"/pages/order/order"})},1e3)):console.log(e.body.status.errorDesc)})}}};e.default=r},"8d57":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"imageUploadContainer"},[a("v-uni-view",{staticClass:"imageUploadList"},[t._l(t.imageListData,function(e,i){return a("v-uni-view",{key:i,staticClass:"imageItem"},[a("v-uni-image",{class:{dragging:t.isDragging(i)},attrs:{src:e,draggable:"true","data-index":i},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.start.apply(void 0,arguments)},touchmove:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.move.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.stop.apply(void 0,arguments)},click:function(e){arguments[0]=e=t.$handleEvent(e),t.previewImage.apply(void 0,arguments)}}}),t.isShowDel?a("v-uni-view",{staticClass:"imageDel",attrs:{"data-index":i},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteImage.apply(void 0,arguments)}}},[t._v("x")]):t._e()],1)}),t.isShowAdd?a("v-uni-view",{staticClass:"imageUpload",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectImage.apply(void 0,arguments)}}},[t._v("+")]):t._e()],2),t.showMoveImage?a("v-uni-image",{staticClass:"moveImage",style:{left:t.posMoveImageLeft,top:t.posMoveImageTop},attrs:{src:t.moveImagePath}}):t._e()],1)},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})},"9a3c":function(t,e,a){"use strict";a.r(e);var i=a("a800"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},"9f9c":function(t,e,a){var i=a("ca1e");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("4f06").default;o("2b424a56",i,!0,{sourceMap:!1,shadowMode:!1})},a800:function(t,e,a){"use strict";var i=a("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(a("795b"));a("ac6a"),a("5df3");var s={name:"robby-image-upload",props:["value","enableDel","enableAdd","enableDrag","serverUrl","formData","header","limit","fileKeyName","showUploadProgress","serverUrlDeleteImage"],data:function(){return{imageBasePos:{x0:-1,y0:-1,w:-1,h:-1},showMoveImage:!1,moveImagePath:"",moveLeft:0,moveTop:0,deltaLeft:0,deltaTop:0,dragIndex:null,targetImageIndex:null,imageList:[],isDestroyed:!1}},mounted:function(){this.imageList=this.value,!1===this.showUploadProgress?this.showUploadProgress=!1:this.showUploadProgress=!0},destroyed:function(){this.isDestroyed=!0},computed:{imageListData:function(){if(this.value)return this.value},posMoveImageLeft:function(){return this.moveLeft+"px"},posMoveImageTop:function(){return this.moveTop+"px"},isShowDel:function(){return!1!==this.enableDel},isShowAdd:function(){return!1!==this.enableAdd&&!(this.limit&&this.imageList.length>=this.limit)},isDragable:function(){return!1!==this.enableDrag}},methods:{selectImage:function(){var t=this;t.imageList||(t.imageList=[]),uni.chooseImage({count:t.limit?t.limit-t.imageList.length:999,success:function(e){var a=e.tempFilePaths;if(t.limit){var i=t.limit-t.imageList.length;if(i<a.length)return void uni.showToast({title:"图片总数限制为"+t.limit+"张，当前还可以选"+i+"张",icon:"none",mask:!1,duration:2e3})}if(t.serverUrl){uni.showToast({title:"上传进度：0/"+a.length,icon:"none",mask:!1});for(var s=t.imageList.length-a.length,n=[],r=t.fileKeyName?t.fileKeyName:"upload-images",l=0,d=function(e){n.push(new o.default(function(i,o){var n=s+e;uni.uploadFile({url:t.serverUrl,fileType:"image",header:t.header,formData:t.formData,filePath:a[e],name:r,success:function(e){if(200===e.statusCode){if(t.isDestroyed)return;l++,t.showUploadProgress&&uni.showToast({title:"上传进度："+l+"/"+a.length,icon:"none",mask:!1,duration:500}),console.log("success to upload image: "+e.data),i(e.data)}else console.log("fail to upload image:"+e.data),o("fail to upload image:"+n)},fail:function(t){console.log("fail to upload image:"+t),o("fail to upload image:"+n)}})}))},u=0;u<a.length;u++)d(u);o.default.all(n).then(function(e){if(!t.isDestroyed){for(var i=0;i<e.length;i++)t.imageList.push(e[i]);t.$emit("add",{currentImages:a,allImages:t.imageList}),t.$emit("input",t.imageList)}})}else{for(u=0;u<a.length;u++)t.imageList.push(a[u]);t.$emit("add",{currentImages:a,allImages:t.imageList}),t.$emit("input",t.imageList)}}})},deleteImage:function(t){var e=t.currentTarget.dataset.index,a=this.imageList[e];this.imageList.splice(e,1),this.serverUrlDeleteImage&&uni.request({url:this.serverUrlDeleteImage,method:"GET",data:{imagePath:a},success:function(t){console.log(t.data)}}),this.$emit("delete",{currentImage:a,allImages:this.imageList}),this.$emit("input",this.imageList)},previewImage:function(t){var e=t.currentTarget.dataset.index;uni.previewImage({current:this.imageList[e],indicator:"number",loop:"true",urls:this.imageList})},initImageBasePos:function(){var t=.024,e=this;uni.getSystemInfo({success:function(a){var i=a.screenWidth,o=Math.ceil(t*i),s=Math.ceil((i-2*o)/4);e.imageBasePos.x0=o,e.imageBasePos.w=s,e.imageBasePos.h=s}})},findOverlapImage:function(t,e){var a=Math.floor((t-this.imageBasePos.x0)/this.imageBasePos.w),i=Math.floor((e-this.imageBasePos.y0)/this.imageBasePos.h),o=4*i+a;return o},isDragging:function(t){return this.dragIndex===t},start:function(t){if(console.log(this.isDragable),this.isDragable){if(this.dragIndex=t.currentTarget.dataset.index,this.moveImagePath=this.imageList[this.dragIndex],this.showMoveImage=!0,-1===this.imageBasePos.y0){this.initImageBasePos();var e=Math.floor(this.dragIndex/4)*this.imageBasePos.h,a=t.currentTarget.offsetTop;this.imageBasePos.y0=a-e}this.moveLeft=t.target.offsetLeft,this.moveTop=t.target.offsetTop}},move:function(t){if(this.isDragable){var e=t.touches[0];this.targetImageIndex=this.findOverlapImage(e.clientX,e.clientY),0===this.deltaLeft&&(this.deltaLeft=e.clientX-this.moveLeft,this.deltaTop=e.clientY-this.moveTop),this.moveLeft=e.clientX-this.deltaLeft,this.moveTop=e.clientY-this.deltaTop}},stop:function(t){this.isDragable&&(null!==this.dragIndex&&null!==this.targetImageIndex&&(this.targetImageIndex<0&&(this.targetImageIndex=0),this.targetImageIndex>=this.imageList.length&&(this.targetImageIndex=this.imageList.length-1),this.dragIndex!==this.targetImageIndex&&(this.imageList[this.dragIndex]=this.imageList[this.targetImageIndex],this.imageList[this.targetImageIndex]=this.moveImagePath)),this.dragIndex=null,this.targetImageIndex=null,this.deltaLeft=0,this.deltaTop=0,this.showMoveImage=!1,this.$emit("input",this.imageList))}}};e.default=s},afde:function(t,e,a){"use strict";var i=a("9f9c"),o=a.n(i);o.a},b4d7:function(t,e,a){"use strict";var i=a("cb01"),o=a.n(i);o.a},ca1e:function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,".imageUploadContainer[data-v-03a99f1b]{padding:%?10?% %?5?%;margin:%?10?% %?5?%}.dragging[data-v-03a99f1b]{-webkit-transform:scale(1.2);transform:scale(1.2)}.imageUploadList[data-v-03a99f1b]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap}.imageItem[data-v-03a99f1b],.imageUpload[data-v-03a99f1b]{width:%?160?%;height:%?160?%;margin:%?10?%}.imageDel[data-v-03a99f1b]{position:relative;left:%?120?%;bottom:%?165?%;background-color:rgba(0,0,0,.5);width:%?36?%;text-align:center;line-height:%?35?%;border-radius:%?17?%;color:#fff;font-size:%?30?%;padding-bottom:%?2?%}.imageItem uni-image[data-v-03a99f1b],.moveImage[data-v-03a99f1b]{width:%?160?%;height:%?160?%;border-radius:%?8?%}.imageUpload[data-v-03a99f1b]{line-height:%?130?%;text-align:center;font-size:%?150?%;color:#d9d9d9;border:1px solid #d9d9d9;border-radius:%?8?%}.moveImage[data-v-03a99f1b]{position:absolute}",""])},cb01:function(t,e,a){var i=a("cbf0");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("4f06").default;o("efabcfcc",i,!0,{sourceMap:!1,shadowMode:!1})},cbf0:function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/* 页面左右间距 */\n/* 文字尺寸 */\n/*文字颜色*/\n/* 边框颜色 */\n/* 图片加载中颜色 */\n/* 行为相关颜色 */uni-page-body[data-v-3652480a]{background:#f8f8f8;padding:0 %?30?% %?40?% %?30?%}.evaluation-item[data-v-3652480a]{background:#fff;margin-top:%?20?%;padding:%?10?%}.evaluation-item .evaluation-product[data-v-3652480a]{width:100%}.evaluation-item .evaluation-product uni-image[data-v-3652480a]{float:left;height:%?70?%;width:%?70?%}.evaluation-item .evaluation-product .desc[data-v-3652480a]{display:-webkit-box;display:-webkit-flex;display:flex;color:#303133;font-size:%?28?%;height:%?70?%;line-height:%?70?%;white-space:"nowrap";overflow:hidden;text-overflow:ellipsis;padding-left:%?20?%}.evaluation-item .evaluation-star[data-v-3652480a]{margin-top:%?20?%;display:-webkit-box;display:-webkit-flex;display:flex}.evaluation-item .evaluation-star .desc[data-v-3652480a]{color:#606266;font-size:%?30?%;height:%?50?%;line-height:%?50?%}.evaluation-item .evaluation-star .star[data-v-3652480a]{padding-left:%?20?%}.evaluation-item .evaluation-star .star .star-item[data-v-3652480a]{width:%?50?%;height:%?50?%}.evaluation-item .evaluation-comment[data-v-3652480a]{margin-top:%?20?%}.evaluation-item .evaluation-comment uni-textarea[data-v-3652480a]{padding:%?10?%;font-size:%?28?%}.evaluation-item .evaluation-image[data-v-3652480a]{display:-webkit-box;display:-webkit-flex;display:flex}.evaluation-item .evaluation-image uni-image[data-v-3652480a]{width:%?100?%;height:%?100?%;padding:%?10?%}.evaluate-btn[data-v-3652480a]{margin-bottom:%?80?%;z-index:95;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:%?690?%;height:%?80?%;font-size:%?32?%;color:#fff;background-color:#fa436a;border-radius:%?10?%;box-shadow:1px 2px 5px rgba(219,63,96,.4)}body.?%PAGE?%[data-v-3652480a]{background:#f8f8f8}',""])}}]);