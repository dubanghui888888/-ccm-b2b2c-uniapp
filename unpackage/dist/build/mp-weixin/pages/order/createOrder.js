(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"1f3e":function(t,e,u){"use strict";u.r(e);var n=u("eecb"),o=u("57f5");for(var s in o)"default"!==s&&function(t){u.d(e,t,function(){return o[t]})}(s);u("fd39");var r=u("2877"),a=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=a.exports},"57f5":function(t,e,u){"use strict";u.r(e);var n=u("cdde"),o=u.n(n);for(var s in n)"default"!==s&&function(t){u.d(e,t,function(){return n[t]})}(s);e["default"]=o.a},"8b23":function(t,e,u){"use strict";(function(t){u("542b"),u("921b");n(u("66fd"));var e=n(u("1f3e"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,u("543d")["createPage"])},aa1d:function(t,e,u){},cdde:function(t,e,u){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u("2f62");function o(t){for(var e=1;e<arguments.length;e++){var u=null!=arguments[e]?arguments[e]:{},n=Object.keys(u);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(u).filter(function(t){return Object.getOwnPropertyDescriptor(u,t).enumerable}))),n.forEach(function(e){s(t,e,u[e])})}return t}function s(t,e,u){return e in t?Object.defineProperty(t,e,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[e]=u,t}var r=function(){return u.e("components/uni-popup/uni-popup").then(u.bind(null,"bc88"))},a={data:function(){return{tabCurrentIndex:0,navList:[{state:"1",text:"快递配送"}],cartIds:[],carts:[],productAmount:0,deductAmount:0,actualAmount:0,freightAmount:0,addressData:{},merchantData:{},maskState:0,memo:"",payType:1,coupons:[],selectedCoupon:{},type:"",isMultipleMerchant:!1}},components:{uniPopup:r},onLoad:function(e){var u=JSON.parse(e.data);u.length<0&&t.navigateBack({delta:1}),this.cartIds=u,this.applicationConfig.applicationMerchantEnabled&&this.navList.push({state:"2",text:"门店自提"}),this.inquiryProductByCartId(this.cartIds),this.inquiryDefaultAddress(this.userInfo.userUuid),this.searchCoupon()},computed:o({},(0,n.mapState)(["hasLogin","userInfo","applicationConfig"])),watch:{addressData:function(t){this.calculateFreightAmount(this.cartIds,t.province,t.city,t.area)}},methods:{tabClick:function(t){this.tabCurrentIndex=t,1==t?this.actualAmount=this.productAmount-this.deductAmount:0==t&&(this.actualAmount=this.productAmount-this.deductAmount+this.freightAmount)},inquiryDefaultAddress:function(t){var e=this,u={userDTO:{userUuid:t}};this.$api.request.userShip(u,function(t){"0"===t.body.status.statusCode?t.body.data.addresses.forEach(function(t,u){t.default&&(e.addressData=t)}):console.log(t.body.status.errorDesc)})},inquiryProductByCartId:function(t){var e=this,u=this,n=t.split(",");this.$api.request.productByCardIds(n,function(t){if("0"===t.body.status.statusCode){e.carts=t.body.data.carts;var n=e.calcSelectedProductAmount(e.carts);e.productAmount=n.toFixed(2),e.actualAmount=e.productAmount-e.deductAmount+e.freightAmount,e.carts.forEach(function(t,e){u.carts[e+1].productDTO.merchantDTO.merchantUuid!=u.carts[e].productDTO.merchantDTO.merchantUuid&&(u.isMultipleMerchant=!0)})}else console.log(t.body.status.errorDesc)})},searchCoupon:function(){var t=this,e=["USER","IS_EXPIRED","IS_USED","IS_STARTED"],u={keyArray:e,userUuid:this.userInfo.userUuid,expired:!1,used:!1,started:!0,startIndex:0,pageSize:50};this.$api.request.userCoupon(u,function(e){if("0"===e.body.status.statusCode){var u=e.body.data.userCoupons;t.coupons=u}},!0)},clearSelectedCoupon:function(){this.selectedCoupon={},this.deductAmount=0,this.actualAmount=this.productAmount-this.deductAmount+this.freightAmount},selectCoupon:function(t){var e=this,u={shoppingCartUuidList:this.cartIds.split(","),userCouponDTO:{couponDTO:{couponUuid:t.couponDTO.couponUuid}}};this.$api.request.calculateCouponAmount(u,function(u){"0"===u.body.status.statusCode?(e.deductAmount=u.body.data.deductAmount,e.actualAmount=e.productAmount-e.deductAmount+e.freightAmount,e.selectedCoupon=t,e.$refs.showcoupon.close()):e.$api.msg(u.body.status.errorDesc)},!1)},calculateFreightAmount:function(t,e,u,n){var o=this,s={shoppingCartUuidList:this.cartIds.split(","),deliveryProvince:e,deliveryCity:u,deliveryArea:n};this.$api.request.calculateFreightAmount(s,function(t){"0"===t.body.status.statusCode?(o.freightAmount=t.body.data.freightAmount,o.actualAmount=o.productAmount-o.deductAmount+o.freightAmount):o.$api.msg(t.body.status.errorDesc)},!1)},calcSelectedProductAmount:function(t){var e=0;return t.forEach(function(t,u){t.productDTO.skuEnabled?e+=t.productSkuDTO.skuUnitPrice*t.unit:e+=t.productDTO.unitPrice*t.unit}),e},change:function(t){console.log("是否打开:"+t.show)},togglePopup:function(t,e){var u=this;switch(t){case"top":this.content="顶部弹出 popup";break;case"bottom":this.content="底部弹出 popup";break;case"center":this.content="居中弹出 popup";break}this.type=t,this.$nextTick(function(){u.$refs["show"+e].open()})},toggleMask:function(t){var e=this,u="show"===t?10:300,n="show"===t?1:0;this.maskState=2,setTimeout(function(){e.maskState=n},u)},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},submit:function(){var e=this;if(0!=this.tabCurrentIndex||this.addressData.userDeliveryAddressUuid)if(1!=this.tabCurrentIndex||this.merchantData.merchantUuid){var u={actionType:"ADD",userDTO:{userUuid:this.userInfo.userUuid},deliveryAddressDTO:{userDeliveryAddressUuid:this.addressData.userDeliveryAddressUuid},merchantDTO:{merchantUuid:this.merchantData.merchantUuid},deliveryType:0==this.tabCurrentIndex?"1":"2",shoppingCartUuidList:this.cartIds.split(",")};this.selectedCoupon.userCouponUuid&&(u.userCouponDTO={userCouponUuid:this.selectedCoupon.userCouponUuid,couponDTO:{couponUuid:this.selectedCoupon.couponDTO.couponUuid}}),this.$api.request.createOrder(u,function(u){"0"===u.body.status.statusCode?t.redirectTo({url:"/pages/money/pay?pOrderNo="+u.body.data.pOrderNo}):e.$api.msg(u.body.status.errorDesc)})}else this.$api.msg("未选择提货门店");else this.$api.msg("未选择收货地址")},stopPrevent:function(){}}};e.default=a}).call(this,u("543d")["default"])},eecb:function(t,e,u){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},o=[];u.d(e,"a",function(){return n}),u.d(e,"b",function(){return o})},fd39:function(t,e,u){"use strict";var n=u("aa1d"),o=u.n(n);o.a}},[["8b23","common/runtime","common/vendor"]]]);